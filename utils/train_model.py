# train_model.py
import sys
from pathlib import Path

sys.path.insert(0, str(Path(__file__).parent.parent / "src"))

from file_sorter import FileSorter
import logging

def setup_console_logging():
    """–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –≤—ã–≤–æ–¥ –ª–æ–≥–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª—å"""
    console_handler = logging.StreamHandler()
    console_handler.setLevel(logging.INFO)
    formatter = logging.Formatter('%(levelname)s - %(message)s')
    console_handler.setFormatter(formatter)
    
    logger = logging.getLogger('FileSorter')
    logger.addHandler(console_handler)
    logger.setLevel(logging.INFO)

def main():
    print("üöÄ –ó–ê–ü–£–°–ö –û–ë–£–ß–ï–ù–ò–Ø ML –ú–û–î–ï–õ–ò")
    print("=" * 50)
    
    setup_console_logging()
    
    # –ü–æ–ª–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    training_data = {
        'work': [
            "–†–∞–±–æ—á–∏–π –ø—Ä–æ–µ–∫—Ç –∏ –∑–∞–¥–∞—á–∏ –Ω–∞ –Ω–µ–¥–µ–ª—é –≤—Å—Ç—Ä–µ—á–∞ —Å –∫–ª–∏–µ–Ω—Ç–æ–º",
            "–ü—Ä–æ–µ–∫—Ç–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ—Ç—á–µ—Ç—ã –¥–µ–¥–ª–∞–π–Ω –ø–ª–∞–Ω —Ä–∞–±–æ—Ç",
            "–ë–∏–∑–Ω–µ—Å –≤—Å—Ç—Ä–µ—á–∞ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ",
            "–†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–¥–∞—á–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ",
            "–û—Ñ–∏—Å —Ä–∞–±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–µ–∫—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ",
            "–ó–∞–¥–∞—á–∏ –Ω–∞ –¥–µ–Ω—å –Ω–µ–¥–µ–ª—é –º–µ—Å—è—Ü —Ä–∞–±–æ—á–∏–π –≥—Ä–∞—Ñ–∏–∫",
            "–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ",
            "–°–æ–≤–µ—â–∞–Ω–∏–µ –ø–ª–∞–Ω–µ—Ä–∫–∞ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–µ",
        ],
        'finance': [
            "–ë—é–¥–∂–µ—Ç —Å–µ–º—å–∏ –æ–ø–ª–∞—Ç–∞ —Å—á–µ—Ç–æ–≤ –±–∞–Ω–∫ –∑–∞—Ä–ø–ª–∞—Ç–∞",
            "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç –∫–≤–∞—Ä—Ç–∞–ª –¥–µ–Ω—å–≥–∏ –¥–æ—Ö–æ–¥ —Ä–∞—Å—Ö–æ–¥",
            "–ù–∞–ª–æ–≥–æ–≤–∞—è –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∏ –±—é–¥–∂–µ—Ç –¥–µ–Ω—å–≥–∏",
            "–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π —Å—á–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥ –¥–µ–Ω—å–≥–∏ —Ñ–∏–Ω–∞–Ω—Å—ã",
            "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –∞–∫—Ü–∏–∏ –æ–±–ª–∏–≥–∞—Ü–∏–∏ –ø–æ—Ä—Ç—Ñ–µ–ª—å",
            "–ö—Ä–µ–¥–∏—Ç –∏–ø–æ—Ç–µ–∫–∞ –∑–∞–µ–º –ø–ª–∞—Ç–µ–∂ –±–∞–Ω–∫",
            "–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –ø–æ–ª–∏—Å –≤—ã–ø–ª–∞—Ç–∞ —Ä–∏—Å–∫",
            "–î–µ–Ω—å–≥–∏ –≤–∞–ª—é—Ç–∞ –∫—É—Ä—Å –æ–±–º–µ–Ω –ø—Ä–∏–±—ã–ª—å",
        ],
        'personal': [
            "–ü–ª–∞–Ω—ã –æ—Ç–ø—É—Å–∫ —Å–µ–º—å—è –¥—Ä—É–∑—å—è –ø—Ä–∞–∑–¥–Ω–∏–∫ –≤—Å—Ç—Ä–µ—á–∞",
            "–°–µ–º–µ–π–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤–∏–¥–µ–æ –ª–∏—á–Ω—ã–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è",
            "–õ–∏—á–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ –¥–Ω–µ–≤–Ω–∏–∫ –º—ã—Å–ª–∏ –∏–¥–µ–∏ –ø–ª–∞–Ω—ã",
            "–î—Ä—É–∑—å—è –≤–µ—á–µ—Ä–∏–Ω–∫–∞ –ø—Ä–∞–∑–¥–Ω–∏–∫ –≤—Å—Ç—Ä–µ—á–∞ –æ–±—â–µ–Ω–∏–µ",
            "–•–æ–±–±–∏ —É–≤–ª–µ—á–µ–Ω–∏–µ –æ—Ç–¥—ã—Ö —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–µ",
            "–ó–¥–æ—Ä–æ–≤—å–µ —Å–ø–æ—Ä—Ç –ø–∏—Ç–∞–Ω–∏–µ –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏",
            "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ø–æ–µ–∑–¥–∫–∞ –æ—Ç–ø—É—Å–∫ –æ—Ç–¥—ã—Ö",
            "–î–æ–º —Å–µ–º—å—è –¥–µ—Ç–∏ —Ä–æ–¥–∏—Ç–µ–ª–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è",
        ],
        'study': [
            "–õ–µ–∫—Ü–∏–∏ –∫—É—Ä—Å –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ",
            "–£—á–µ–±–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∫–æ–Ω—Å–ø–µ–∫—Ç—ã —ç–∫–∑–∞–º–µ–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞",
            "–ù–∞—É—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –æ–±—É—á–µ–Ω–∏–µ",
            "–ö—É—Ä—Å –ª–µ–∫—Ü–∏–∏ —Å–µ–º–∏–Ω–∞—Ä –ø—Ä–∞–∫—Ç–∏–∫–∞ –∑–∞–¥–∞–Ω–∏–µ",
            "–°—Ç—É–¥–µ–Ω—Ç —É—á–µ–±–∞ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∑–Ω–∞–Ω–∏—è",
            "–ö–Ω–∏–≥–∏ —É—á–µ–±–Ω–∏–∫–∏ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞ —á—Ç–µ–Ω–∏–µ",
            "–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç",
            "–ü—Ä–æ–µ–∫—Ç –¥–∏–ø–ª–æ–º –∫—É—Ä—Å–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞",
        ]
    }
    
    print(f"üìä –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:")
    for category, texts in training_data.items():
        print(f"   {category}: {len(texts)} —Ç–µ–∫—Å—Ç–æ–≤")
    
    print("\nüß† –ù–∞—á–∏–Ω–∞–µ–º –æ–±—É—á–µ–Ω–∏–µ Word2Vec –º–æ–¥–µ–ª–∏...")
    
    # –°–æ–∑–¥–∞–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤—â–∏–∫
    sorter = FileSorter("data/raw", "data/sorted")
    
    # –û–±—É—á–∞–µ–º –º–æ–¥–µ–ª—å
    success = sorter.train_ml_model(training_data)
    
    if success:
        print("\n‚úÖ –ú–æ–¥–µ–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±—É—á–µ–Ω–∞!")
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–æ–¥–µ–ª–∏
        model_info = sorter.ml_classifier.get_model_info()
        print(f"\nüìä –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ú–û–î–ï–õ–ò:")
        print(f"   –°—Ç–∞—Ç—É—Å: {model_info['status']}")
        print(f"   –†–∞–∑–º–µ—Ä —Å–ª–æ–≤–∞—Ä—è: {model_info['vocabulary_size']} —Å–ª–æ–≤")
        print(f"   –†–∞–∑–º–µ—Ä –≤–µ–∫—Ç–æ—Ä–∞: {model_info['vector_size']}")
        print(f"   –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: {', '.join(model_info['categories'])}")
        
    else:
        print("\n‚ùå –û—à–∏–±–∫–∞ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏!")
    
    print("\n" + "=" * 50)
    print("üèÅ –û–ë–£–ß–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û")

if __name__ == '__main__':
    main()